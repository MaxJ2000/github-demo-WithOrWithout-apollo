{"ast":null,"code":"import _defineProperty from \"/home/john/Documents/Code/github-demo-WithOrWithout-apollo/with-apollo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/home/john/Documents/Code/github-demo-WithOrWithout-apollo/with-apollo/src/Repository/RepositoryItem/index.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React from 'react';\nimport { Mutation } from 'react-apollo';\nimport REPOSITORY_FRAGMENT from '../fragments';\nimport Link from '../../Link';\nimport Button from '../../Button';\nimport '../style.css';\nimport { STAR_REPOSITORY, UNSTAR_REPOSITORY, WATCH_REPOSITORY } from '../mutations';\nvar VIEWER_SUBSCRIPTIONS = {\n  SUBSCRIBED: 'SUBSCRIBED',\n  UNSUBSCRIBED: 'UNSUBSCRIBED'\n};\n\nvar isWatch = function isWatch(viewerSubscription) {\n  return viewerSubscription === VIEWER_SUBSCRIPTIONS.SUBSCRIBED;\n};\n\nvar updateWatch = function updateWatch(client, _ref) {\n  var _ref$data$updateSubsc = _ref.data.updateSubscription.subscribable,\n      id = _ref$data$updateSubsc.id,\n      viewerSubscription = _ref$data$updateSubsc.viewerSubscription;\n  var repository = client.readFragment({\n    id: \"Repository:\".concat(id),\n    fragment: REPOSITORY_FRAGMENT\n  });\n  var totalCount = repository.watchers.totalCount;\n  totalCount = viewerSubscription === VIEWER_SUBSCRIPTIONS.SUBSCRIBED ? totalCount + 1 : totalCount - 1;\n  client.writeFragment({\n    id: \"Repository:\".concat(id),\n    fragment: REPOSITORY_FRAGMENT,\n    data: _objectSpread({}, repository, {\n      watchers: _objectSpread({}, repository.watchers, {\n        totalCount: totalCount\n      })\n    })\n  });\n};\n\nvar updateAddStar = function updateAddStar(client, _ref2) {\n  var _ref2$data$addStar$st = _ref2.data.addStar.starrable,\n      id = _ref2$data$addStar$st.id,\n      viewerHasStarred = _ref2$data$addStar$st.viewerHasStarred;\n  return client.writeFragment({\n    id: \"Repository:\".concat(id),\n    fragment: REPOSITORY_FRAGMENT,\n    data: getUpdatedStarData(client, id, viewerHasStarred)\n  });\n};\n\nvar updateRemoveStar = function updateRemoveStar(client, _ref3) {\n  var _ref3$data$removeStar = _ref3.data.removeStar.starrable,\n      id = _ref3$data$removeStar.id,\n      viewerHasStarred = _ref3$data$removeStar.viewerHasStarred;\n  client.writeFragment({\n    id: \"Repository:\".concat(id),\n    fragment: REPOSITORY_FRAGMENT,\n    data: getUpdatedStarData(client, id, viewerHasStarred)\n  });\n};\n\nvar getUpdatedStarData = function getUpdatedStarData(client, id, viewerHasStarred) {\n  var repository = client.readFragment({\n    id: \"Repository:\".concat(id),\n    fragment: REPOSITORY_FRAGMENT\n  });\n  var totalCount = repository.stargazers.totalCount;\n  totalCount = viewerHasStarred ? totalCount + 1 : totalCount - 1;\n  return _objectSpread({}, repository, {\n    stargazers: _objectSpread({}, repository.stargazers, {\n      totalCount: totalCount\n    })\n  });\n};\n\nvar RepositoryItem = function RepositoryItem(_ref4) {\n  var id = _ref4.id,\n      name = _ref4.name,\n      url = _ref4.url,\n      descriptionHTML = _ref4.descriptionHTML,\n      primaryLanguage = _ref4.primaryLanguage,\n      owner = _ref4.owner,\n      stargazers = _ref4.stargazers,\n      watchers = _ref4.watchers,\n      viewerSubscription = _ref4.viewerSubscription,\n      viewerHasStarred = _ref4.viewerHasStarred;\n  return React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"RepositoryItem-title\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122\n    },\n    __self: this\n  }, React.createElement(\"h2\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123\n    },\n    __self: this\n  }, React.createElement(Link, {\n    href: url,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124\n    },\n    __self: this\n  }, name)), React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127\n    },\n    __self: this\n  }, React.createElement(Mutation, {\n    mutation: WATCH_REPOSITORY,\n    variables: {\n      id: id,\n      viewerSubscription: isWatch(viewerSubscription) ? VIEWER_SUBSCRIPTIONS.UNSUBSCRIBED : VIEWER_SUBSCRIPTIONS.SUBSCRIBED\n    },\n    optimisticResponse: {\n      updateSubscription: {\n        __typename: 'Mutation',\n        subscribable: {\n          __typename: 'Repository',\n          id: id,\n          viewerSubscription: isWatch(viewerSubscription) ? VIEWER_SUBSCRIPTIONS.UNSUBSCRIBED : VIEWER_SUBSCRIPTIONS.SUBSCRIBED\n        }\n      }\n    },\n    update: updateWatch,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128\n    },\n    __self: this\n  }, function (updateSubscription, _ref5) {\n    var data = _ref5.data,\n        loading = _ref5.loading,\n        error = _ref5.error;\n    return React.createElement(Button, {\n      className: \"RepositoryItem-title-action\",\n      \"data-test-id\": \"updateSubscription\",\n      onClick: updateSubscription,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151\n      },\n      __self: this\n    }, watchers.totalCount, ' ', isWatch(viewerSubscription) ? 'Unwatch' : 'Watch');\n  }), !viewerHasStarred ? React.createElement(Mutation, {\n    mutation: STAR_REPOSITORY,\n    variables: {\n      id: id\n    },\n    optimisticResponse: {\n      addStar: {\n        __typename: 'Mutation',\n        starrable: {\n          __typename: 'Repository',\n          id: id,\n          viewerHasStarred: !viewerHasStarred\n        }\n      }\n    },\n    update: updateAddStar,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163\n    },\n    __self: this\n  }, function (addStar, _ref6) {\n    var data = _ref6.data,\n        loading = _ref6.loading,\n        error = _ref6.error;\n    return React.createElement(Button, {\n      className: 'RepositoryItem-title-action',\n      onClick: addStar,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179\n      },\n      __self: this\n    }, stargazers.totalCount, \" Star\");\n  }) : React.createElement(Mutation, {\n    mutation: UNSTAR_REPOSITORY,\n    variables: {\n      id: id\n    },\n    optimisticResponse: {\n      removeStar: {\n        __typename: 'Mutation',\n        starrable: {\n          __typename: 'Repository',\n          id: id,\n          viewerHasStarred: !viewerHasStarred\n        }\n      }\n    },\n    update: updateRemoveStar,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188\n    },\n    __self: this\n  }, function (removeStar, _ref7) {\n    var data = _ref7.data,\n        loading = _ref7.loading,\n        error = _ref7.error;\n    return React.createElement(Button, {\n      className: \"RepositoryItem-title-action\",\n      onClick: removeStar,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204\n      },\n      __self: this\n    }, stargazers.totalCount, \" Unstar\");\n  }))), React.createElement(\"div\", {\n    className: \"RepositoryItem-description\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"RepositoryItem-description-info\",\n    dangerouslySetInnerHTML: {\n      __html: descriptionHTML\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"RepositoryItem-description-details\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222\n    },\n    __self: this\n  }, primaryLanguage && React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224\n    },\n    __self: this\n  }, \"Language: \", primaryLanguage.name)), React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227\n    },\n    __self: this\n  }, owner && React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229\n    },\n    __self: this\n  }, \"Owner: \", React.createElement(\"a\", {\n    href: owner.url,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230\n    },\n    __self: this\n  }, owner.login))))));\n};\n\nexport default RepositoryItem;","map":{"version":3,"sources":["/home/john/Documents/Code/github-demo-WithOrWithout-apollo/with-apollo/src/Repository/RepositoryItem/index.js"],"names":["React","Mutation","REPOSITORY_FRAGMENT","Link","Button","STAR_REPOSITORY","UNSTAR_REPOSITORY","WATCH_REPOSITORY","VIEWER_SUBSCRIPTIONS","SUBSCRIBED","UNSUBSCRIBED","isWatch","viewerSubscription","updateWatch","client","data","updateSubscription","subscribable","id","repository","readFragment","fragment","totalCount","watchers","writeFragment","updateAddStar","addStar","starrable","viewerHasStarred","getUpdatedStarData","updateRemoveStar","removeStar","stargazers","RepositoryItem","name","url","descriptionHTML","primaryLanguage","owner","__typename","loading","error","__html","login"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Mutation } from 'react-apollo';\n\nimport REPOSITORY_FRAGMENT from '../fragments';\nimport Link from '../../Link';\nimport Button from '../../Button';\n\nimport '../style.css';\n\nimport {\n  STAR_REPOSITORY,\n  UNSTAR_REPOSITORY,\n  WATCH_REPOSITORY,\n} from '../mutations';\n\nconst VIEWER_SUBSCRIPTIONS = {\n  SUBSCRIBED: 'SUBSCRIBED',\n  UNSUBSCRIBED: 'UNSUBSCRIBED',\n};\n\nconst isWatch = viewerSubscription =>\n  viewerSubscription === VIEWER_SUBSCRIPTIONS.SUBSCRIBED;\n\nconst updateWatch = (\n  client,\n  {\n    data: {\n      updateSubscription: {\n        subscribable: { id, viewerSubscription },\n      },\n    },\n  },\n) => {\n  const repository = client.readFragment({\n    id: `Repository:${id}`,\n    fragment: REPOSITORY_FRAGMENT,\n  });\n\n  let { totalCount } = repository.watchers;\n  totalCount =\n    viewerSubscription === VIEWER_SUBSCRIPTIONS.SUBSCRIBED\n      ? totalCount + 1\n      : totalCount - 1;\n\n  client.writeFragment({\n    id: `Repository:${id}`,\n    fragment: REPOSITORY_FRAGMENT,\n    data: {\n      ...repository,\n      watchers: {\n        ...repository.watchers,\n        totalCount,\n      },\n    },\n  });\n};\n\nconst updateAddStar = (\n  client,\n  {\n    data: {\n      addStar: {\n        starrable: { id, viewerHasStarred },\n      },\n    },\n  },\n) =>\n  client.writeFragment({\n    id: `Repository:${id}`,\n    fragment: REPOSITORY_FRAGMENT,\n    data: getUpdatedStarData(client, id, viewerHasStarred),\n  });\n\nconst updateRemoveStar = (\n  client,\n  {\n    data: {\n      removeStar: {\n        starrable: { id, viewerHasStarred },\n      },\n    },\n  },\n) => {\n  client.writeFragment({\n    id: `Repository:${id}`,\n    fragment: REPOSITORY_FRAGMENT,\n    data: getUpdatedStarData(client, id, viewerHasStarred),\n  });\n};\n\nconst getUpdatedStarData = (client, id, viewerHasStarred) => {\n  const repository = client.readFragment({\n    id: `Repository:${id}`,\n    fragment: REPOSITORY_FRAGMENT,\n  });\n\n  let { totalCount } = repository.stargazers;\n  totalCount = viewerHasStarred ? totalCount + 1 : totalCount - 1;\n\n  return {\n    ...repository,\n    stargazers: {\n      ...repository.stargazers,\n      totalCount,\n    },\n  };\n};\n\nconst RepositoryItem = ({\n  id,\n  name,\n  url,\n  descriptionHTML,\n  primaryLanguage,\n  owner,\n  stargazers,\n  watchers,\n  viewerSubscription,\n  viewerHasStarred,\n}) => (\n  <div>\n    <div className=\"RepositoryItem-title\">\n      <h2>\n        <Link href={url}>{name}</Link>\n      </h2>\n\n      <div>\n        <Mutation\n          mutation={WATCH_REPOSITORY}\n          variables={{\n            id,\n            viewerSubscription: isWatch(viewerSubscription)\n              ? VIEWER_SUBSCRIPTIONS.UNSUBSCRIBED\n              : VIEWER_SUBSCRIPTIONS.SUBSCRIBED,\n          }}\n          optimisticResponse={{\n            updateSubscription: {\n              __typename: 'Mutation',\n              subscribable: {\n                __typename: 'Repository',\n                id,\n                viewerSubscription: isWatch(viewerSubscription)\n                  ? VIEWER_SUBSCRIPTIONS.UNSUBSCRIBED\n                  : VIEWER_SUBSCRIPTIONS.SUBSCRIBED,\n              },\n            },\n          }}\n          update={updateWatch}\n        >\n          {(updateSubscription, { data, loading, error }) => (\n            <Button\n              className=\"RepositoryItem-title-action\"\n              data-test-id=\"updateSubscription\"\n              onClick={updateSubscription}\n            >\n              {watchers.totalCount}{' '}\n              {isWatch(viewerSubscription) ? 'Unwatch' : 'Watch'}\n            </Button>\n          )}\n        </Mutation>\n\n        {!viewerHasStarred ? (\n          <Mutation\n            mutation={STAR_REPOSITORY}\n            variables={{ id }}\n            optimisticResponse={{\n              addStar: {\n                __typename: 'Mutation',\n                starrable: {\n                  __typename: 'Repository',\n                  id,\n                  viewerHasStarred: !viewerHasStarred,\n                },\n              },\n            }}\n            update={updateAddStar}\n          >\n            {(addStar, { data, loading, error }) => (\n              <Button\n                className={'RepositoryItem-title-action'}\n                onClick={addStar}\n              >\n                {stargazers.totalCount} Star\n              </Button>\n            )}\n          </Mutation>\n        ) : (\n          <Mutation\n            mutation={UNSTAR_REPOSITORY}\n            variables={{ id }}\n            optimisticResponse={{\n              removeStar: {\n                __typename: 'Mutation',\n                starrable: {\n                  __typename: 'Repository',\n                  id,\n                  viewerHasStarred: !viewerHasStarred,\n                },\n              },\n            }}\n            update={updateRemoveStar}\n          >\n            {(removeStar, { data, loading, error }) => (\n              <Button\n                className=\"RepositoryItem-title-action\"\n                onClick={removeStar}\n              >\n                {stargazers.totalCount} Unstar\n              </Button>\n            )}\n          </Mutation>\n        )}\n      </div>\n    </div>\n\n    <div className=\"RepositoryItem-description\">\n      <div\n        className=\"RepositoryItem-description-info\"\n        dangerouslySetInnerHTML={{ __html: descriptionHTML }}\n      />\n      <div className=\"RepositoryItem-description-details\">\n        <div>\n          {primaryLanguage && (\n            <span>Language: {primaryLanguage.name}</span>\n          )}\n        </div>\n        <div>\n          {owner && (\n            <span>\n              Owner: <a href={owner.url}>{owner.login}</a>\n            </span>\n          )}\n        </div>\n      </div>\n    </div>\n  </div>\n);\n\nexport default RepositoryItem;\n"]},"metadata":{},"sourceType":"module"}